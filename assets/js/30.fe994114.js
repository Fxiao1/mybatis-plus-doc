(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{395:function(t,e,s){"use strict";s.r(e);var r=s(25),a=Object(r.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"乐观锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#乐观锁"}},[t._v("#")]),t._v(" 乐观锁")]),t._v(" "),s("h2",{attrs:{id:"optimisticlockerinnerinterceptor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#optimisticlockerinnerinterceptor"}},[t._v("#")]),t._v(" OptimisticLockerInnerInterceptor")]),t._v(" "),s("blockquote",[s("p",[t._v("当要更新一条记录的时候，希望这条记录没有被别人更新"),s("br"),t._v("\n乐观锁实现方式：")]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("取出记录时，获取当前version")]),t._v(" "),s("li",[t._v("更新时，带上这个version")]),t._v(" "),s("li",[t._v("执行更新时， set version = newVersion where version = oldVersion")]),t._v(" "),s("li",[t._v("如果version不对，就更新失败")])])])]),t._v(" "),s("h3",{attrs:{id:"使用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方法"}},[t._v("#")]),t._v(" 使用方法")]),t._v(" "),s("p",[t._v("字段上加上"),s("code",[t._v("@Version")]),t._v("注解")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Version")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("说明:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("支持的数据类型只有:int,Integer,long,Long,Date,Timestamp,LocalDateTime")])]),t._v(" "),s("li",[t._v("整数类型下 "),s("code",[t._v("newVersion = oldVersion + 1")])]),t._v(" "),s("li",[s("code",[t._v("newVersion")]),t._v(" 会回写到 "),s("code",[t._v("entity")]),t._v(" 中")]),t._v(" "),s("li",[t._v("仅支持 "),s("code",[t._v("updateById(id)")]),t._v(" 与 "),s("code",[t._v("update(entity, wrapper)")]),t._v(" 方法")]),t._v(" "),s("li",[s("strong",[t._v("在 "),s("code",[t._v("update(entity, wrapper)")]),t._v(" 方法下, "),s("code",[t._v("wrapper")]),t._v(" 不能复用!!!")])])])])])}),[],!1,null,null,null);e.default=a.exports}}]);